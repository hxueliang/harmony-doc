1.  【多线程】什么场景会用到多线程

    1.  复杂计算：针对需要进行复杂计算或大量数据处理的任务，可以使用多线程来加速处理过程，提高系统整体性能。
    2.  后台任务处理：对于需要长时间运行的后台任务，可以使用多线程来进行处理，避免阻塞主线程而影响其他功能的正常运行。
    3.  UI 界面操作：主要的 UI 界面操作通常都是在主线程中完成的，但是仍然存在一些特定场景需要多线程处理，例如：

        1.  耗时操作： 如果在 UI 界面操作中包含了耗时的计算或 IO 操作，比如大量数据的处理、图片处理、文件读写等，这些操作会阻塞主线程并影响 UI 的流畅性，因此可以使用多线程来避免阻塞主线程。
        2.  复杂动画： 对于一些复杂的动画效果，如果在主线程中处理可能会影响到 UI 的流畅性，可以通过多线程来进行动画计算和渲染，从而提高动画效果的流畅度。
        3.  并发处理： 在一些需要同时进行多个任务处理的场景下，比如同时加载多张图片、多个网络请求并行处理等，使用多线程可以更有效地提高处理效率。
        4.  因此，尽管 UI 界面操作通常在主线程中进行，但在特定的场景下，仍然需要多线程来处理一些复杂的任务，从而确保应用的性能和用户体验。

    4.  网络通信：网络通信通过异步方式可以解决大部分情况下的并发处理需求，但是仍然存在一些特定场景需要多线程处理，例如：

        1.  高并发请求：异步方式虽然可以处理网络通信并发请求，但在面对大规模高并发请求时，多线程处理能够更有效地提高处理效率和系统性能。

            1.  大规模数据传输： 当需要进行大规模数据传输时，例如批量上传或下载大量文件、大容量的数据同步等，多线程可以并行处理多个网络请求，提高传输效率和速度。

            2.  后台数据同步： 对于需要与服务器进行频繁的数据同步的应用，如即时通讯应用、社交媒体应用等，多线程可以实现并发的网络请求，以减少同步时间并保持数据的及时性。

            3.  同时进行多个网络操作： 在某些场景下，需要同时进行多个网络操作，如同时发送多个 HTTP 请求、同时进行不同接口的请求等。采用多线程可以并发处理这些网络操作，提高整体系统的并发处理能力。

            4.  优化用户体验： 高并发的网络请求可能会导致界面卡顿或阻塞主线程，影响用户体验。通过使用多线程，可以将网络请求放到后台线程中处理，保持 UI 的流畅性，提升用户体验。

            5.  需要注意的是，在使用多线程处理高并发的网络请求时，还需要考虑线程安全、资源竞争等问题，确保多线程操作的正确性和稳定性。此外，也要根据具体的场景和需求，合理选择使用多线程的方式来处理高并发的网络请求。

        2.  复杂数据处理：在进行网络通信后，可能需要对接收到的数据进行复杂的处理，比如加密、压缩或解析等操作。这些操作可能会占用较长时间，使用多线程能够避免阻塞主线程，保持应用的响应性。

        3.  资源共享问题：在网络通信过程中，可能涉及多个资源的读写操作，如果不适当地处理，可能会导致资源竞争和锁问题。多线程可以更好地管理资源访问，提高效率

        4.  因此，尽管鸿蒙系统支持异步方式处理网络通信，但在特定的场景下，仍然需要多线程来处理一些复杂的并发需求。

2.  【多线程】项目中有用到多线程嘛，具体说一下多线程的作用，如何使用的

    1.  TaskPool

    1.  import { taskpool } from '@kit.ArkTS'
    1.  taskpool.execute(task1)
    1.  taskpool.execute(task2)

    1.  Worker

    1.  处理图片压缩处理完成之后任务，如图片上传

3.  【多线程】说说你对 TaskPool 和 Worker 的理解？

4.  TaskPool 和 Worker 均支持多线程并发能力。由于 TaskPool 的工作线程会绑定系统的调度优先级，并且支持负载均衡（自动扩缩容），而 Worker 需要开发者自行创建，存在创建耗时以及不支持设置调度优先级，故在性能方面使用 TaskPool 会优于 Worker，因此大多数场景推荐使用 TaskPool。
5.  TaskPool 偏向独立任务维度，该任务在线程中执行，无需关注线程的生命周期，超长任务（大于 3 分钟且非长时任务）会被系统自动回收；
6.  而 Worker 偏向线程的维度，支持长时间占据线程执行，需要主动管理线程生命周期。
7.  场景

    1.  运行时间超过 3 分钟（不包含 Promise 和 async/await 异步调用的耗时，例如网络下载、文件读写等 I/O 任务的耗时）的任务。例如后台进行 1 小时的预测算法训练等 CPU 密集型任务，需要使用 Worker。
    2.  有关联的一系列同步任务。例如在一些需要创建、使用句柄的场景中，句柄创建每次都是不同的，该句柄需永久保存，保证使用该句柄进行操作，需要使用 Worker。
    3.  需要设置优先级的任务。例如图库直方图绘制场景，后台计算的直方图数据会用于前台界面的显示，影响用户体验，需要高优先级处理，需要使用 TaskPool。
    4.  需要频繁取消的任务。例如图库大图浏览场景，为提升体验，会同时缓存当前图片左右侧各 2 张图片，往一侧滑动跳到下一张图片时，要取消另一侧的一个缓存任务，需要使用 TaskPool。
    5.  大量或者调度点较分散的任务。例如大型应用的多个模块包含多个耗时任务，不方便使用 Worker 去做负载管理，推荐采用 TaskPool。

- 【多线程】是否用过多线程，鸿蒙有哪些多线程，为什么鸿蒙提供这些多线程，有什么使用场景

  1.  肯定用过
  2.  TaskPool、Worker
  3.  因为他们虽然都是多线程，但使用的场景不一样
  4.  接上一题场景说明

- 【多线程】多线程 Worker 与 Emitter 的区别是什么？是否能自动更新 UI？worker 最大的数量是多少？

  1.  Emitter——主要提供线程间发送和处理事件的能力，包括对持续订阅事件或单次订阅事件的处理、取消订阅事件、发送事件到事件队列等。
  2.  Worker——主要作用是为应用程序提供一个多线程的运行环境，可满足应用程序在执行过程中与主线程分离，在后台线程中运行一个脚本操作耗时操作，极大避免类似于计算密集型或高延迟的任务阻塞主线程的运行
  3.  不能更新 UI，最大数量 64 个， 用完 worker 要销毁

- 【多线程】多线程使用首选项需要注意什么

- 在 TaskPool 或 Worker 的工作线程中支持使用的模块，其他模块在使用时需要验证是否满足线程安全

- 其中，首选项并不是支持使用的模块，需要验证是否满足线程安全

1.  【多线程】多线程改变了主线程的值，那么主线程内的值会不会一起改变？

    1.  主线程和其他线程之间是相互独立的，它们有自己的执行上下文和数据空间。因此，如果在多线程环境下修改了一个变量的值，并不会直接影响到主线程内相同变量的值。
    2.  当多个线程同时访问共享的变量时，可能出现并发访问的情况。这种情况下，如果没有进行适当的同步和互斥操作，可能会导致数据竞争和不可预测的结果。因此，在多线程编程中，需要使用合适的同步机制（如锁、信号量等）来保证对共享变量的安全访问。
    3.  如果你想要在多线程中修改一个变量的值，并且希望主线程能够感知到这个改变，你可以通过一些机制来实现通信和同步，例如使用线程间的消息传递、回调函数等方式。这样，主线程就能够及时获取到其他线程修改的值，并进行相应的处理。

2.  【多线程】TaskPool 线程的数据怎么和主线程同步？线程间怎么同步数据？

    1.  线程间的消息传递：Emitter
    2.  回调函数

3.  【多线程】http 是在主线程内还是另起一个线程？那么异步和 TaskPool 有什么区别吗

    1.  HTTP 请求通常是异步执行的。何为异步，即在当前线程内开启一异步任务，该异步任务会放入异步队列中，在当前线程主前任务执行完后，异步队列中取出异步任务去执行，所以 HTTP 是在当前线程内的。即主线程内执行 HTTP 请求，当然和主线程在同一线程内
    2.  异步和 TaskPool 的区别，其实就是异步和多线程的分区

- 异步和多线程都可以达到避免调用线程阻塞的目的
- 异步操作在完成 await 操作后，会发出完成通知，并释放占用的线程，之后系统调用线程池中空余的线程来进行 await 之后的操作，减少了线程负担
- 而多线程编程会在整个任务中一直占用线程造成资源浪费。比如 DMA（直接存储器访问）操作，允许硬件可以不通过 CPU 而直接与内存数据进行交互，在这时闲置的线程无法被释放，造成了资源浪费。（使用异步可以避免

1.  【多线程】http 请求怎么使用 TaskPool 实现？

    1.  async 修饰的函数，默认在底层 C++已经给你创建一个关联起来的 promise deffer 了，不需要再创建一个新的进去，依赖关联不上，所以不支持你 return new 新的 Promise 返回。返回值必须是 Promise
    2.  @Concurrent

&#x20;async function TestTask(url: string, method\:string): Promise {

&#x20;let response: http.HttpResponse = await request(url, method)

&#x20;return response

&#x20;}

1.  【多线程】如何处理高并发

    1.  HarmonyOS 系统提供了异步并发和多线程并发两种处理策略

        1.  异步并发是指异步代码在执行到一定程度后会被暂停，以便在未来某个时间点继续执行，这种情况下，同一时间只有一段代码在执行。
        2.  多线程并发允许在同一时间段内同时执行多段代码。在主线程继续响应用户操作和更新 UI 的同时，后台也能执行耗时操作，从而避免应用出现卡顿。

    2.  ArkTS 支持异步并发和多线程并发

        1.  Promise(async/await)提供异步并发能力，适用于单次 I/O 任务的开发场景。详细请参见异步并发概述。
        2.  TaskPool 和 Worker 提供多线程并发能力，适用于 CPU 密集型任务、I/O 密集型任务和同步任务等并发场景。详细请参见多线程并发概述。

2.  【多线程】线程池的作用，线程和线程池的关系

    1.  线程池是一种管理和复用线程的机制，它可以帮助我们更有效地使用系统资源，并且可以提高程序的性能和响应速度。
    2.  线程池的作用主要包括以下几个方面：

- 减少线程创建和销毁的开销：线程的创建和销毁是非常消耗资源的操作。通过使用线程池，可以避免频繁地创建和销毁线程，从而减少了这部分资源消耗。

- 控制并发线程数量：线程池可以限制同时执行的线程数量，防止因为大量线程并发而导致系统资源耗尽或者性能下降的情况发生。

- 提高任务处理速度：线程池可以预先创建一定数量的线程，当有新的任务到达时，可以直接将任务分配给空闲的线程执行，从而避免了线程创建的开销，提高了任务的处理速度。

- 统一管理和监控：通过线程池，可以对线程的创建、销毁、执行进行统一管理，也方便对线程的运行状态进行监控和调优。

- 线程和线程池的关系是线程池是对线程的一种管理方式。在使用线程时，如果需要频繁地创建和销毁线程，会消耗大量的系统资源，同时也会影响程序的性能。而线程池则可以解决这个问题，它可以维护一定数量的线程，按需分配任务给这些线程执行，避免了重复创建和销毁线程的开销，提高了系统的性能和资源利用率。因此，线程池是对线程的一种高效管理方式，能够更好地利用系统资源，并提高程序的性能。
